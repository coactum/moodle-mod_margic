define ("mod_margic/highlighting",["exports","jquery","./types","./text-range"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.describe=function(a,b){for(var d=[c.RangeAnchor,c.TextPositionAnchor,c.TextQuoteAnchor],e=[],f=0,g=d,h;f<g.length;f++){h=g[f];try{var i=h.fromRange(a,b);e.push(i.toSelector())}catch(a){continue}}return e};a.anchor=function(a,b){var c=function(b){var c=h(b);if(!c){return}var d=[];if(a.annotation){d=i(c,a.annotation.id,"annotated",a.annotation.color)}else{d=i(c,!1,"annotated_temp")}d.forEach(function(a){a._annotation=b.annotation});b.highlights=d};if(!a.target){a.target=[]}var f=a.target.map(function locate(c){if(!c.selector||!c.selector.some(function(a){return"TextQuoteSelector"===a.type})){return{annotation:a,target:c}}var e;try{var f=m(b,c.selector),g=d.TextRange.fromRange(f);e={annotation:a,target:c,range:g}}catch(b){e={annotation:a,target:c}}return e}),g=e(f),j;try{for(g.s();!(j=g.n()).done;){var k=j.value;c(k)}}catch(a){g.e(a)}finally{g.f()}a.$orphan=0<f.length&&f.every(function(a){return a.target.selector&&!a.range});return f};a.removeAllTempHighlights=n;b=function(a){return a&&a.__esModule?a:{default:a}}(b);function e(a){if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(a=f(a))){var b=0,c=function(){};return{s:c,n:function n(){if(b>=a.length)return{done:!0};return{done:!1,value:a[b++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,e=!0,g=!1,h;return{s:function s(){d=a[Symbol.iterator]()},n:function n(){var a=d.next();e=a.done;return a},e:function e(a){g=!0;h=a},f:function f(){try{if(!e&&null!=d.return)d.return()}finally{if(g)throw h}}}}function f(a,b){if(!a)return;if("string"==typeof a)return g(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return g(a,b)}function g(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function h(a){if(!a.range){return null}try{return a.range.toRange()}catch(a){return null}}function i(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"annotated",d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"FFFF00",e=j(a),f=[],g=null,h=null;e.forEach(function(a){if(g&&g.nextSibling===a){h.push(a)}else{h=[a];f.push(h)}g=a});f=f.filter(function(a){return a.some(function(a){return!/^\s*$/.test(a.nodeValue)})});var i=[];f.forEach(function(a){var e=document.createElement("margic-highlight");e.className=c;if(b){e.className+=" "+c+"-"+b;e.style="text-decoration:underline; text-decoration-color: #"+d;e.id=c+"-"+b;e.style.backgroundColor="#"+d}var f=a[0].parentNode;f.replaceChild(e,a[0]);a.forEach(function(a){return e.appendChild(a)});i.push(e)});return i}function j(a){if(a.collapsed){return[]}var b=a.commonAncestorContainer;if(b.nodeType!==Node.ELEMENT_NODE){b=b.parentElement}if(!b){return[]}var c=[],d=b.ownerDocument.createNodeIterator(b,NodeFilter.SHOW_TEXT),e;while(e=d.nextNode()){if(!k(a,e)){continue}var f=e;if(f===a.startContainer&&0<a.startOffset){f.splitText(a.startOffset);continue}if(f===a.endContainer&&a.endOffset<f.data.length){f.splitText(a.endOffset)}c.push(f)}return c}function k(a,b){try{var c,d,e=null!==(c=null===(d=b.nodeValue)||void 0===d?void 0:d.length)&&void 0!==c?c:b.childNodes.length;return 0>=a.comparePoint(b,0)&&0<=a.comparePoint(b,e)}catch(a){return!1}}function l(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return a.toRange(b)}function m(a,b){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},f=null,g=null,h=null,i=e(b),j;try{for(i.s();!(j=i.n()).done;){var n=j.value;switch(n.type){case"TextPositionSelector":f=n;d.hint=f.start;break;case"TextQuoteSelector":g=n;break;case"RangeSelector":h=n;break;}}}catch(a){i.e(a)}finally{i.f()}var k=function(a){var b;if((null===(b=g)||void 0===b?void 0:b.exact)&&a.toString()!==g.exact){throw new Error("quote mismatch")}else{return a}},m=!1;try{if(h){var o=c.RangeAnchor.fromSelector(a,h);m=l(o,d);if(m){return m}else{return k}}}catch(b){try{if(f){var p=c.TextPositionAnchor.fromSelector(a,f);m=l(p,d);if(m){return m}else{return k}}}catch(b){try{if(g){var q=c.TextQuoteAnchor.fromSelector(a,g);m=l(q,d);return m}}catch(a){return!1}}}return!1}function n(){var a=Array.from((0,b.default)("body")[0].querySelectorAll(".annotated_temp"));if(a!==void 0&&0!=a.length){o(a)}}function o(a){for(var b=0;b<a.length;b++){if(a[b].parentNode){var c=Array.from(a[b].childNodes);p(a[b],c)}}}function p(a,b){var c=a.parentNode;b.forEach(function(b){return c.insertBefore(b,a)});a.remove()}});
//# sourceMappingURL=highlighting.min.js.map
