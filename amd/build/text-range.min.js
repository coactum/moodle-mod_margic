define("mod_margic/text-range",["exports"],(function(_exports){function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function nodeTextLength(node){switch(node.nodeType){case Node.ELEMENT_NODE:case Node.TEXT_NODE:return node.textContent.length;default:return 0}}function previousSiblingsTextLength(node){for(var sibling=node.previousSibling,length=0;sibling;)length+=nodeTextLength(sibling),sibling=sibling.previousSibling;return length}function resolveOffsets(element){for(var _len=arguments.length,offsets=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)offsets[_key-1]=arguments[_key];for(var textNode,nextOffset=offsets.shift(),nodeIter=element.ownerDocument.createNodeIterator(element,NodeFilter.SHOW_TEXT),results=[],currentNode=nodeIter.nextNode(),length=0;void 0!==nextOffset&&currentNode;)length+(textNode=currentNode).data.length>nextOffset?(results.push({node:textNode,offset:nextOffset-length}),nextOffset=offsets.shift()):(currentNode=nodeIter.nextNode(),length+=textNode.data.length);for(;void 0!==nextOffset&&length===nextOffset;)results.push({node:textNode,offset:textNode.data.length}),nextOffset=offsets.shift();if(void 0!==nextOffset)throw new RangeError("Offset exceeds text length");return results}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.TextRange=_exports.TextPosition=_exports.RESOLVE_FORWARDS=_exports.RESOLVE_BACKWARDS=void 0;_exports.RESOLVE_FORWARDS=1;_exports.RESOLVE_BACKWARDS=2;var TextPosition=function(){function TextPosition(element,offset){if(_classCallCheck(this,TextPosition),offset<0)throw new Error("Offset is invalid");this.element=element,this.offset=offset}return _createClass(TextPosition,[{key:"relativeTo",value:function(parent){if(!parent.contains(this.element))throw new Error("Parent is not an ancestor of current element");for(var el=this.element,offset=this.offset;el!==parent;)offset+=previousSiblingsTextLength(el),el=el.parentElement;return new TextPosition(el,offset)}},{key:"resolve",value:function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return resolveOffsets(this.element,this.offset)[0]}catch(err){if(0===this.offset&&void 0!==options.direction){var tw=document.createTreeWalker(this.element.getRootNode(),NodeFilter.SHOW_TEXT);tw.currentNode=this.element;var forwards=1===options.direction,text=forwards?tw.nextNode():tw.previousNode();if(!text)throw err;return{node:text,offset:forwards?0:text.data.length}}throw err}}}],[{key:"fromCharOffset",value:function(node,offset){switch(node.nodeType){case Node.TEXT_NODE:return TextPosition.fromPoint(node,offset);case Node.ELEMENT_NODE:return new TextPosition(node,offset);default:throw new Error("Node is not an element or text node")}}},{key:"fromPoint",value:function(node,offset){switch(node.nodeType){case Node.TEXT_NODE:if(offset<0||offset>node.data.length)throw new Error("Text node offset is out of range");if(!node.parentElement)throw new Error("Text node has no parent");var textOffset=previousSiblingsTextLength(node)+offset;return new TextPosition(node.parentElement,textOffset);case Node.ELEMENT_NODE:if(offset<0||offset>node.childNodes.length)throw new Error("Child node offset is out of range");for(var _textOffset=0,i=0;i<offset;i++)_textOffset+=nodeTextLength(node.childNodes[i]);return new TextPosition(node,_textOffset);default:throw new Error("Point is not in an element or text node")}}}]),TextPosition}();_exports.TextPosition=TextPosition;var TextRange=function(){function TextRange(start,end){_classCallCheck(this,TextRange),this.start=start,this.end=end}return _createClass(TextRange,[{key:"relativeTo",value:function(element){return new TextRange(this.start.relativeTo(element),this.end.relativeTo(element))}},{key:"toRange",value:function(){var start,end;if(this.start.element===this.end.element&&this.start.offset<=this.end.offset){var _resolveOffsets2=_slicedToArray(resolveOffsets(this.start.element,this.start.offset,this.end.offset),2);start=_resolveOffsets2[0],end=_resolveOffsets2[1]}else start=this.start.resolve({direction:1}),end=this.end.resolve({direction:2});var range=new Range;return range.setStart(start.node,start.offset),range.setEnd(end.node,end.offset),range}}],[{key:"fromRange",value:function(range){return new TextRange(TextPosition.fromPoint(range.startContainer,range.startOffset),TextPosition.fromPoint(range.endContainer,range.endOffset))}},{key:"fromOffsets",value:function(root,start,end){return new TextRange(new TextPosition(root,start),new TextPosition(root,end))}}]),TextRange}();_exports.TextRange=TextRange}));

//# sourceMappingURL=text-range.min.js.map