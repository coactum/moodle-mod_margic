function _createForOfIteratorHelper(a){if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(a=_unsupportedIterableToArray(a))){var b=0,c=function(){};return{s:c,n:function n(){if(b>=a.length)return{done:!0};return{done:!1,value:a[b++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,e=!0,f=!1,g;return{s:function s(){d=a[Symbol.iterator]()},n:function n(){var a=d.next();e=a.done;return a},e:function e(a){f=!0;g=a},f:function f(){try{if(!e&&null!=d.return)d.return()}finally{if(f)throw g}}}}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}define ("mod_margic/annotations",["jquery"],function(a){return{init:function init(b,c){a(".annotation-form").hide();a(".annotation-form div.col-md-3").removeClass("col-md-3");a(".annotation-form div.col-md-9").removeClass("col-md-9");a(".annotation-form div.form-group").removeClass("form-group");a(".annotation-form div.row").removeClass("row");function d(d){if(c){r();f();var e=b[d].entry;a(".annotation-box-"+d).hide();a(".annotation-form-"+e+" input[name=\"startcontainer\"]").val(b[d].startcontainer);a(".annotation-form-"+e+" input[name=\"endcontainer\"]").val(b[d].endcontainer);a(".annotation-form-"+e+" input[name=\"startposition\"]").val(b[d].startposition);a(".annotation-form-"+e+" input[name=\"endposition\"]").val(b[d].endposition);a(".annotation-form-"+e+" input[name=\"annotationid\"]").val(d);a(".annotation-form-"+e+" textarea[name=\"text\"]").val(b[d].text);a(".annotation-form-"+e+" select").val(b[d].type);a("#annotationpreview-temp-"+e).html(a("#annotationpreview-"+d).html());a("#annotationpreview-temp-"+e).css("border-color","#"+b[d].color);a(".annotationarea-"+e+" .annotation-form").insertBefore(".annotation-box-"+d);a(".annotationarea-"+e+" .annotation-form").show();a(".annotationarea-"+e+" #id_text").focus()}}function f(){a(".annotation-form").hide();a(".annotation-form input[name^=\"annotationid\"]").val(null);a(".annotation-form input[name^=\"startcontainer\"]").val(-1);a(".annotation-form input[name^=\"endcontainer\"]").val(-1);a(".annotation-form input[name^=\"startposition\"]").val(-1);a(".annotation-form input[name^=\"endposition\"]").val(-1);a(".annotation-form textarea[name^=\"text\"]").val("");a(".annotation-box").not(".annotation-form").show()}function g(a){if(a.collapsed){return[]}var b=a.commonAncestorContainer;if(b.nodeType!==Node.ELEMENT_NODE){b=b.parentElement}if(!b){return[]}var c=[],d=b.ownerDocument.createNodeIterator(b,NodeFilter.SHOW_TEXT),e;while(e=d.nextNode()){if(!i(a,e)){continue}var f=e;if(f===a.startContainer&&0<a.startOffset){f.splitText(a.startOffset);continue}if(f===a.endContainer&&a.endOffset<f.data.length){f.splitText(a.endOffset)}c.push(f)}return c}function h(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"annotated",d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"FFFF00",e=g(a),f=[],h=null,i=null;e.forEach(function(a){if(h&&h.nextSibling===a){i.push(a)}else{i=[a];f.push(i)}h=a});f=f.filter(function(a){return a.some(function(a){return!/^\s*$/.test(a.nodeValue)})});var j="";f.forEach(function(a){var e=document.createElement("span");e.className=c;if(b){e.className+=" "+c+"-"+b;e.id=c+"-"+b;e.style.backgroundColor="#"+d}j+=a[0].textContent;a[0].parentNode.replaceChild(e,a[0]);a.forEach(function(a){return e.appendChild(a)})});return j}function i(a,b){try{var c,d,e=null!==(c=null===(d=b.nodeValue)||void 0===d?void 0:d.length)&&void 0!==c?c:b.childNodes.length;return 0>=a.comparePoint(b,0)&&0<=a.comparePoint(b,e)}catch(a){return!1}}function j(a){var b=a.nodeName.toLowerCase(),c=b;if("#text"===b){c="text()"}return c}function k(a){var b=0,c=a;while(c){if(c.nodeName===a.nodeName){b+=1}c=c.previousSibling}return b}function l(a){var b=j(a),c=k(a);return"".concat(b,"[").concat(c,"]")}function m(a,b){var c="",d=a;while(d!==b){if(!d){throw new Error("Node is not a descendant of root")}c=l(d)+"/"+c;d=d.parentNode}c="/"+c;c=c.replace(/\/$/,"");return c}function n(a,b,c){b=b.toUpperCase();for(var d=-1,e=0,f;e<a.children.length;e++){f=a.children[e];if(f.nodeName.toUpperCase()===b){++d;if(d===c){return f}}}return null}function o(a,b){var c=null!==a.match(/^(\/[A-Za-z0-9-]+(\[[0-9]+\])?)+$/);if(!c){throw new Error("Expression is not a simple XPath")}var d=a.split("/"),e=b;d.shift();var f=_createForOfIteratorHelper(d),g;try{for(f.s();!(g=f.n()).done;){var h=g.value,i=void 0,j=void 0,k=h.indexOf("[");if(-1!==k){i=h.slice(0,k);var l=h.slice(k+1,h.indexOf("]"));j=parseInt(l)-1;if(0>j){return null}}else{i=h;j=0}var m=n(e,i,j);if(!m){return null}e=m}}catch(a){f.e(a)}finally{f.f()}return e}function p(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:document.body;try{return o(a,b)}catch(c){return document.evaluate("."+a,b,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}function q(a,b){var c=a.parentNode;b.forEach(function(b){return c.insertBefore(b,a)});a.remove()}function r(){var b=Array.from(a("body")[0].querySelectorAll(".annotated_temp"));if(b!==void 0&&0!=b.length){s(b)}}function s(a){for(var b=0;b<a.length;b++){if(a[b].parentNode){var c=a[b].parentNode,d=Array.from(a[b].childNodes);q(a[b],d);c.normalize()}}}a(document).on("mouseup",".originaltext",function(){var b=window.getSelection().getRangeAt(0);if(""!==b.cloneContents().textContent&&c){r();f();var d=this.id.replace(/entry-/,"");a(".annotation-form-"+d+" input[name=\"startcontainer\"]").val(m(b.startContainer,this));a(".annotation-form-"+d+" input[name=\"endcontainer\"]").val(m(b.endContainer,this));a(".annotation-form-"+d+" input[name=\"startposition\"]").val(b.startOffset);a(".annotation-form-"+d+" input[name=\"endposition\"]").val(b.endOffset);a(".annotation-form-"+d+" select").val(1);var e=h(b,!1,"annotated_temp");if(""!=e){a("#annotationpreview-temp-"+d).html(e)}a(".annotationarea-"+d+" .annotation-form").show();a(".annotation-form-"+d+" #id_text").focus()}});(function(){for(var c=0,d=Object.values(b);c<d.length;c++){var e=d[c],f=document.createRange();try{f.setStart(p(e.startcontainer,a("#entry-"+e.entry)[0]),e.startposition);f.setEnd(p(e.endcontainer,a("#entry-"+e.entry)[0]),e.endposition)}catch(a){}var g=h(f,e.id,"annotated",e.color);if(""!=g){a("#annotationpreview-"+e.id).html(g)}}})();a(".annotated").mouseenter(function(){var b=this.id.replace("annotated-","");a(".annotationpreview-"+b).addClass("hovered");a(".annotated-"+b).addClass("hovered")});a(".annotated").mouseleave(function(){var b=this.id.replace("annotated-","");a(".annotationpreview-"+b).removeClass("hovered");a(".annotated-"+b).removeClass("hovered")});a(".annotatedtextpreview").mouseenter(function(){var b=this.id.replace("annotationpreview-","");a(".annotated-"+b).addClass("hovered")});a(".annotatedtextpreview").mouseleave(function(){var b=this.id.replace("annotationpreview-","");a(".annotated-"+b).removeClass("hovered")});a(document).on("mouseover",".annotated_temp",function(){a(".annotated_temp").addClass("hovered")});a(document).on("mouseleave",".annotated_temp",function(){a(".annotated_temp").removeClass("hovered")});a(document).on("click",".annotated",function(){var a=this.id.replace("annotated-","");d(a)});a(document).on("click",".edit-annotation",function(){var a=this.id.replace("edit-annotation-","");d(a)});a(document).on("click","#id_cancel",function(a){a.preventDefault();r();f()});a("textarea").keypress(function(b){if(13==b.which){a(this).parents(":eq(2)").submit();b.preventDefault()}})}}});
//# sourceMappingURL=annotations.min.js.map
