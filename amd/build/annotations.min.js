function _createForOfIteratorHelper(a){if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(a=_unsupportedIterableToArray(a))){var b=0,c=function(){};return{s:c,n:function n(){if(b>=a.length)return{done:!0};return{done:!1,value:a[b++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,e=!0,f=!1,g;return{s:function s(){d=a[Symbol.iterator]()},n:function n(){var a=d.next();e=a.done;return a},e:function e(a){f=!0;g=a},f:function f(){try{if(!e&&null!=d.return)d.return()}finally{if(f)throw g}}}}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}define ("mod_annotateddiary/annotations",["jquery","mod_annotateddiary/addertoolbar_new"],function(a){return{init:function init(b){console.log("SITE IS LOADED");a(".mform").hide();a(".mform div.col-md-3").removeClass("col-md-3");a(".mform div.col-md-9").removeClass("col-md-9");a(".mform div.form-group").removeClass("form-group");a(".mform div.row").removeClass("row");function c(c){q();d();console.log("annotations from js");console.log(b);var e=b[c].entry;console.log(e);a("input[name=\"startcontainer["+e+"]\"]").val(b[c].startcontainer);a("input[name=\"endcontainer["+e+"]\"]").val(b[c].endcontainer);a("input[name=\"startposition["+e+"]\"]").val(b[c].startposition);a("input[name=\"endposition["+e+"]\"]").val(b[c].endposition);a("textarea[name=\"text["+e+"]\"]").val(b[c].text);a(".annotationarea-"+e+" .mform").show();a("#id_text_"+e).focus()}function d(){a(".mform").hide();a(".mform input[name^=\"annotationid\"]").val(null);a(".mform input[name^=\"startcontainer\"]").val(-1);a(".mform input[name^=\"endcontainer\"]").val(-1);a(".mform input[name^=\"startposition\"]").val(-1);a(".mform input[name^=\"endposition\"]").val(-1);a(".mform textarea[name^=\"text\"]").val("")}function e(a){if(a.collapsed){return[]}var b=a.commonAncestorContainer;if(b.nodeType!==Node.ELEMENT_NODE){b=b.parentElement}if(!b){return[]}var c=[],d=b.ownerDocument.createNodeIterator(b,NodeFilter.SHOW_TEXT),e;while(e=d.nextNode()){if(!g(a,e)){continue}var f=e;if(f===a.startContainer&&0<a.startOffset){f.splitText(a.startOffset);continue}if(f===a.endContainer&&a.endOffset<f.data.length){f.splitText(a.endOffset)}c.push(f)}return c}function f(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"annotated";console.log("highlightRange start");var d=e(a),f=0<d.length&&h(d[0]),g=[],i=null,j=null;d.forEach(function(a){if(i&&i.nextSibling===a){j.push(a)}else{j=[a];g.push(j)}i=a});g=g.filter(function(a){return a.some(function(a){return!/^\s*$/.test(a.nodeValue)})});var k=[];g.forEach(function(a){var d=document.createElement("span");d.className=c;if(b){d.className+=" "+c+"-"+b;d.id=c+"-"+b}a[0].parentNode.replaceChild(d,a[0]);a.forEach(function(a){return d.appendChild(a)});k.push(d)});console.log("highlightRange end");return k}function g(a,b){try{var c,d,e=null!==(c=null===(d=b.nodeValue)||void 0===d?void 0:d.length)&&void 0!==c?c:b.childNodes.length;return 0>=a.comparePoint(b,0)&&0<=a.comparePoint(b,e)}catch(a){return!1}}function h(a){if(!a.parentElement){return!1}return null!==a.parentElement.closest(".annotator-placeholder")}function i(a){var b=a.nodeName.toLowerCase(),c=b;if("#text"===b){c="text()"}return c}function j(a){var b=0,c=a;while(c){if(c.nodeName===a.nodeName){b+=1}c=c.previousSibling}return b}function k(a){var b=i(a),c=j(a);return"".concat(b,"[").concat(c,"]")}function l(a,b){var c="",d=a;while(d!==b){if(!d){throw new Error("Node is not a descendant of root")}c=k(d)+"/"+c;d=d.parentNode}c="/"+c;c=c.replace(/\/$/,"");return c}function m(a,b,c){b=b.toUpperCase();for(var d=-1,e=0,f;e<a.children.length;e++){f=a.children[e];if(f.nodeName.toUpperCase()===b){++d;if(d===c){return f}}}return null}function n(a,b){var c=null!==a.match(/^(\/[A-Za-z0-9-]+(\[[0-9]+\])?)+$/);if(!c){throw new Error("Expression is not a simple XPath")}var d=a.split("/"),e=b;d.shift();var f=_createForOfIteratorHelper(d),g;try{for(f.s();!(g=f.n()).done;){var h=g.value,i=void 0,j=void 0,k=h.indexOf("[");if(-1!==k){i=h.slice(0,k);var l=h.slice(k+1,h.indexOf("]"));j=parseInt(l)-1;if(0>j){return null}}else{i=h;j=0}var n=m(e,i,j);if(!n){return null}e=n}}catch(a){f.e(a)}finally{f.f()}return e}function o(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:document.body;try{return n(a,b)}catch(c){return document.evaluate("."+a,b,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}function p(a,b){var c=a.parentNode;b.forEach(function(b){return c.insertBefore(b,a)});a.remove()}function q(){var b=Array.from(a("body")[0].querySelectorAll(".annotated_temp"));if(b!==void 0&&0!=b.length){r(b)}}function r(a){for(var b=0;b<a.length;b++){if(a[b].parentNode){var c=Array.from(a[b].childNodes);p(a[b],c)}}}a(document).on("mouseup",".originaltext",function(){var b=window.getSelection().getRangeAt(0);console.log("window.getSelection()");console.log(window.getSelection());console.log("selectedrange");console.log(b);if(""!==b.cloneContents().textContent){q();d();var c=this.id.replace(/entry-/,"");console.log("selectedrange.cloneContents().textContent");console.log(b.cloneContents().textContent);a("input[name=\"startcontainer["+c+"]\"]").val(l(b.startContainer,this));a("input[name=\"endcontainer["+c+"]\"]").val(l(b.endContainer,this));a("input[name=\"startposition["+c+"]\"]").val(b.startOffset);a("input[name=\"endposition["+c+"]\"]").val(b.endOffset);f(b,!1,"annotated_temp");a(".annotationarea-"+c+" .mform").show();a("#id_text_"+c).focus()}});(function(){for(var c=0,d=Object.values(b),e;c<d.length;c++){e=d[c];console.log(a("#entry-"+e.entry)[0]);var g=document.createRange();try{g.setStart(o(e.startcontainer,a("#entry-"+e.entry)[0]),e.startposition);g.setEnd(o(e.endcontainer,a("#entry-"+e.entry)[0]),e.endposition)}catch(a){console.log("try/catch");console.log(a)}console.log("recreateAnnotations after setStart/End");f(g,e.id)}})();a(".annotated").mouseenter(function(){var b=this.id.replace("annotated-","");a(".annotation-"+b).addClass("hovered");a(".annotated-"+b).addClass("hovered")});a(".annotated").mouseleave(function(){var b=this.id.replace("annotated-","");a(".annotation-"+b).removeClass("hovered");a(".annotated-"+b).removeClass("hovered")});a(".annotation").mouseenter(function(){var b=this.id.replace("annotation-","");a(".annotated-"+b).addClass("hovered")});a(".annotation").mouseleave(function(){var b=this.id.replace("annotation-","");a(".annotated-"+b).removeClass("hovered")});a(document).on("mouseover",".annotated_temp",function(){a(".annotated_temp").addClass("hovered")});a(document).on("mouseleave",".annotated_temp",function(){a(".annotated_temp").removeClass("hovered")});a(document).on("click",".annotated",function(){console.log("annotated text is clicked");console.log(this);var a=this.id.replace("annotated-","");c(a)})}}});
//# sourceMappingURL=annotations.min.js.map
