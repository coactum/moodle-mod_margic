define ("mod_margic/annotations",["exports","jquery","./highlighting"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=function(a){return a&&a.__esModule?a:{default:a}}(b);var e=function(a,e,f,g){var k=!1,l=[],m=!1;(0,b.default)(".annotation-form div.col-md-3").removeClass("col-md-3");(0,b.default)(".annotation-form div.col-md-9").removeClass("col-md-9");(0,b.default)(".annotation-form div.form-group").removeClass("form-group");(0,b.default)(".annotation-form div.row").removeClass("row");(0,b.default)(document).on("click","#id_cancel",function(a){a.preventDefault();(0,c.removeAllTempHighlights)();j();k=!1});(0,b.default)("textarea").keypress(function(a){if(13==a.which){(0,b.default)(this).parents(":eq(2)").submit();a.preventDefault()}});(0,b.default)(document).on("mouseup",".originaltext",function(){var a=window.getSelection().getRangeAt(0);if(""!==a.cloneContents().textContent&&e){(0,c.removeAllTempHighlights)();j();m=d(this);var f=this.id.replace(/entry-/,"");(0,b.default)(".annotation-form-"+f+" input[name=\"startcontainer\"]").val(m.target[0].selector[0].startContainer);(0,b.default)(".annotation-form-"+f+" input[name=\"endcontainer\"]").val(m.target[0].selector[0].endContainer);(0,b.default)(".annotation-form-"+f+" input[name=\"startoffset\"]").val(m.target[0].selector[0].startOffset);(0,b.default)(".annotation-form-"+f+" input[name=\"endoffset\"]").val(m.target[0].selector[0].endOffset);(0,b.default)(".annotation-form-"+f+" input[name=\"start\"]").val(m.target[0].selector[1].start);(0,b.default)(".annotation-form-"+f+" input[name=\"end\"]").val(m.target[0].selector[1].end);(0,b.default)(".annotation-form-"+f+" input[name=\"exact\"]").val(m.target[0].selector[2].exact);(0,b.default)(".annotation-form-"+f+" input[name=\"prefix\"]").val(m.target[0].selector[2].prefix);(0,b.default)(".annotation-form-"+f+" input[name=\"suffix\"]").val(m.target[0].selector[2].suffix);(0,b.default)(".annotation-form-"+f+" select").val(1);(0,b.default)("#annotationpreview-temp-"+f).html(m.target[0].selector[2].exact.replaceAll("<","&lt;").replaceAll(">","&gt;"));(0,b.default)(".annotationarea-"+f+" .annotation-form").show();(0,b.default)(".annotation-form-"+f+" #id_text").focus()}});b.default.ajax({url:"./annotations.php",data:{id:a,getannotations:1},success:function success(a){l=JSON.parse(a);h();(0,b.default)(".annotated").mouseenter(function(){var a=this.id.replace("annotated-","");(0,b.default)(".annotation-box-"+a).addClass("hovered");(0,b.default)(".annotated-"+a).css("background-color","lightblue")});(0,b.default)(".annotated").mouseleave(function(){var a=this.id.replace("annotated-","");(0,b.default)(".annotation-box-"+a).removeClass("hovered");(0,b.default)(".annotated-"+a).css("background-color",(0,b.default)(".annotated-"+a).css("textDecorationColor"))});(0,b.default)(document).on("mouseover",".annotated_temp",function(){(0,b.default)(".annotated_temp").addClass("hovered")});(0,b.default)(document).on("mouseleave",".annotated_temp",function(){(0,b.default)(".annotated_temp").removeClass("hovered")});(0,b.default)(document).on("click",".annotated",function(){var a=this.id.replace("annotated-","");i(a)});(0,b.default)(document).on("click",".edit-annotation",function(){var a=this.id.replace("edit-annotation-","");i(a)});(0,b.default)(document).on("mouseover",".hoverannotation",function(){var a=this.id.replace("hoverannotation-","");(0,b.default)(".annotated-"+a).css("background-color","lightblue")});(0,b.default)(document).on("mouseleave",".hoverannotation",function(){var a=this.id.replace("hoverannotation-","");(0,b.default)(".annotated-"+a).css("background-color",(0,b.default)(".annotated-"+a).css("textDecorationColor"))});if(0!=g){(0,b.default)(".annotated-"+g).attr("tabindex",-1);(0,b.default)(".annotated-"+g).focus()}},complete:function complete(){(0,b.default)("#overlay").hide()},error:function error(){}});function h(){for(var a=0,d=Object.values(l);a<d.length;a++){var e=d[a],f=[[{type:"RangeSelector",startContainer:e.startcontainer,startOffset:parseInt(e.startoffset),endContainer:e.endcontainer,endOffset:parseInt(e.endoffset)},{type:"TextPositionSelector",start:parseInt(e.start),end:parseInt(e.end)},{type:"TextQuoteSelector",exact:e.exact,prefix:e.prefix,suffix:e.suffix}]],g=f.map(function(a){return{selector:a}});(0,c.anchor)({annotation:e,target:g},(0,b.default)("#entry-"+e.entry)[0])}}function i(a){if(k==a){(0,c.removeAllTempHighlights)();j();k=!1}else if(e&&f==l[a].userid){(0,c.removeAllTempHighlights)();j();k=a;var d=l[a].entry;(0,b.default)(".annotation-box-"+a).hide();(0,b.default)(".annotation-form-"+d+" input[name=\"startcontainer\"]").val(l[a].startcontainer);(0,b.default)(".annotation-form-"+d+" input[name=\"endcontainer\"]").val(l[a].endcontainer);(0,b.default)(".annotation-form-"+d+" input[name=\"startoffset\"]").val(l[a].startoffset);(0,b.default)(".annotation-form-"+d+" input[name=\"endoffset\"]").val(l[a].endoffset);(0,b.default)(".annotation-form-"+d+" input[name=\"start\"]").val(l[a].start);(0,b.default)(".annotation-form-"+d+" input[name=\"end\"]").val(l[a].end);(0,b.default)(".annotation-form-"+d+" input[name=\"exact\"]").val(l[a].exact);(0,b.default)(".annotation-form-"+d+" input[name=\"prefix\"]").val(l[a].prefix);(0,b.default)(".annotation-form-"+d+" input[name=\"suffix\"]").val(l[a].suffix);(0,b.default)(".annotation-form-"+d+" input[name=\"annotationid\"]").val(a);(0,b.default)(".annotation-form-"+d+" textarea[name=\"text\"]").val(l[a].text);(0,b.default)(".annotation-form-"+d+" select").val(l[a].type);(0,b.default)("#annotationpreview-temp-"+d).html(l[a].exact.replaceAll("<","&lt;").replaceAll(">","&gt;"));(0,b.default)("#annotationpreview-temp-"+d).css("border-color","#"+l[a].color);(0,b.default)(".annotationarea-"+d+" .annotation-form").insertBefore(".annotation-box-"+a);(0,b.default)(".annotationarea-"+d+" .annotation-form").show();(0,b.default)(".annotationarea-"+d+" #id_text").focus()}else{(0,b.default)(".annotation-box-"+a).focus()}}function j(){(0,b.default)(".annotation-form").hide();(0,b.default)(".annotation-form input[name^=\"annotationid\"]").val(null);(0,b.default)(".annotation-form input[name^=\"startcontainer\"]").val(-1);(0,b.default)(".annotation-form input[name^=\"endcontainer\"]").val(-1);(0,b.default)(".annotation-form input[name^=\"startoffset\"]").val(-1);(0,b.default)(".annotation-form input[name^=\"endoffset\"]").val(-1);(0,b.default)(".annotation-form textarea[name^=\"text\"]").val("");(0,b.default)(".annotation-box").not(".annotation-form").show()}};a.init=e;function d(a){var b=[window.getSelection().getRangeAt(0)];if(b.collapsed){return null}var d=b.map(function(b){return(0,c.describe)(a,b)}),e=d.map(function(a){return{selector:a}}),f={target:e};(0,c.anchor)(f,a);return f}});
//# sourceMappingURL=annotations.min.js.map
