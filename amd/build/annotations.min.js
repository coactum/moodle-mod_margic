define ("mod_margic/annotations",["exports","jquery","./highlighting"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=function(a){return a&&a.__esModule?a:{default:a}}(b);var e=function(a,e,f){var j=!1,k=[],l=!1;(0,b.default)(".annotation-form div.col-md-3").removeClass("col-md-3");(0,b.default)(".annotation-form div.col-md-9").removeClass("col-md-9");(0,b.default)(".annotation-form div.form-group").removeClass("form-group");(0,b.default)(".annotation-form div.row").removeClass("row");(0,b.default)(document).on("click","#id_cancel",function(a){a.preventDefault();(0,c.removeAllTempHighlights)();i();j=!1});(0,b.default)("textarea").keypress(function(a){if(13==a.which){(0,b.default)(this).parents(":eq(2)").submit();a.preventDefault()}});(0,b.default)(document).on("mouseup",".originaltext",function(){var a=window.getSelection().getRangeAt(0);if(""!==a.cloneContents().textContent&&e){(0,c.removeAllTempHighlights)();i();l=d(this);var f=this.id.replace(/entry-/,"");(0,b.default)(".annotation-form-"+f+" input[name=\"startcontainer\"]").val(l.target[0].selector[0].startContainer);(0,b.default)(".annotation-form-"+f+" input[name=\"endcontainer\"]").val(l.target[0].selector[0].endContainer);(0,b.default)(".annotation-form-"+f+" input[name=\"startoffset\"]").val(l.target[0].selector[0].startOffset);(0,b.default)(".annotation-form-"+f+" input[name=\"endoffset\"]").val(l.target[0].selector[0].endOffset);(0,b.default)(".annotation-form-"+f+" input[name=\"start\"]").val(l.target[0].selector[1].start);(0,b.default)(".annotation-form-"+f+" input[name=\"end\"]").val(l.target[0].selector[1].end);(0,b.default)(".annotation-form-"+f+" input[name=\"exact\"]").val(l.target[0].selector[2].exact);(0,b.default)(".annotation-form-"+f+" input[name=\"prefix\"]").val(l.target[0].selector[2].prefix);(0,b.default)(".annotation-form-"+f+" input[name=\"suffix\"]").val(l.target[0].selector[2].suffix);(0,b.default)(".annotation-form-"+f+" select").val(1);(0,b.default)("#annotationpreview-temp-"+f).html(l.target[0].selector[2].exact.replaceAll("<","&lt;").replaceAll(">","&gt;"));(0,b.default)(".annotationarea-"+f+" .annotation-form").show();(0,b.default)(".annotation-form-"+f+" #id_text").focus()}});b.default.ajax({url:"./annotations.php",data:{id:a,getannotations:1},success:function success(a){k=JSON.parse(a);g();(0,b.default)(".annotated").mouseenter(function(){var a=this.id.replace("annotated-","");(0,b.default)(".annotation-box-"+a).addClass("hovered");(0,b.default)(".annotated-"+a).addClass("hovered")});(0,b.default)(".annotated").mouseleave(function(){var a=this.id.replace("annotated-","");(0,b.default)(".annotation-box-"+a).removeClass("hovered");(0,b.default)(".annotated-"+a).removeClass("hovered")});(0,b.default)(document).on("mouseover",".annotated_temp",function(){(0,b.default)(".annotated_temp").addClass("hovered")});(0,b.default)(document).on("mouseleave",".annotated_temp",function(){(0,b.default)(".annotated_temp").removeClass("hovered")});(0,b.default)(document).on("click",".annotated",function(){var a=this.id.replace("annotated-","");h(a)});(0,b.default)(document).on("click",".edit-annotation",function(){var a=this.id.replace("edit-annotation-","");h(a)});(0,b.default)(document).on("mouseover",".hoverannotation",function(){var a=this.id.replace("hoverannotation-","");(0,b.default)(".annotated-"+a).addClass("hovered")});(0,b.default)(document).on("mouseleave",".hoverannotation",function(){var a=this.id.replace("hoverannotation-","");(0,b.default)(".annotated-"+a).removeClass("hovered")})},complete:function complete(){(0,b.default)("#overlay").hide()},error:function error(){alert("Error fetching annotations")}});function g(){for(var a=0,d=Object.values(k);a<d.length;a++){var e=d[a],f=[[{type:"RangeSelector",startContainer:e.startcontainer,startOffset:parseInt(e.startoffset),endContainer:e.endcontainer,endOffset:parseInt(e.endoffset)},{type:"TextPositionSelector",start:parseInt(e.start),end:parseInt(e.end)},{type:"TextQuoteSelector",exact:e.exact,prefix:e.prefix,suffix:e.suffix}]],g=f.map(function(a){return{selector:a}});(0,c.anchor)({annotation:e,target:g},(0,b.default)("#entry-"+e.entry)[0])}}function h(a){if(j==a){(0,c.removeAllTempHighlights)();i();j=!1}else if(e&&f==k[a].userid){(0,c.removeAllTempHighlights)();i();j=a;var d=k[a].entry;(0,b.default)(".annotation-box-"+a).hide();(0,b.default)(".annotation-form-"+d+" input[name=\"startcontainer\"]").val(k[a].startcontainer);(0,b.default)(".annotation-form-"+d+" input[name=\"endcontainer\"]").val(k[a].endcontainer);(0,b.default)(".annotation-form-"+d+" input[name=\"startoffset\"]").val(k[a].startoffset);(0,b.default)(".annotation-form-"+d+" input[name=\"endoffset\"]").val(k[a].endoffset);(0,b.default)(".annotation-form-"+d+" input[name=\"start\"]").val(k[a].start);(0,b.default)(".annotation-form-"+d+" input[name=\"end\"]").val(k[a].end);(0,b.default)(".annotation-form-"+d+" input[name=\"exact\"]").val(k[a].exact);(0,b.default)(".annotation-form-"+d+" input[name=\"prefix\"]").val(k[a].prefix);(0,b.default)(".annotation-form-"+d+" input[name=\"suffix\"]").val(k[a].suffix);(0,b.default)(".annotation-form-"+d+" input[name=\"annotationid\"]").val(a);(0,b.default)(".annotation-form-"+d+" textarea[name=\"text\"]").val(k[a].text);(0,b.default)(".annotation-form-"+d+" select").val(k[a].type);(0,b.default)("#annotationpreview-temp-"+d).html(k[a].exact.replaceAll("<","&lt;").replaceAll(">","&gt;"));(0,b.default)("#annotationpreview-temp-"+d).css("border-color","#"+k[a].color);(0,b.default)(".annotationarea-"+d+" .annotation-form").insertBefore(".annotation-box-"+a);(0,b.default)(".annotationarea-"+d+" .annotation-form").show();(0,b.default)(".annotationarea-"+d+" #id_text").focus()}else{(0,b.default)(".annotation-box-"+a).focus()}}function i(){(0,b.default)(".annotation-form").hide();(0,b.default)(".annotation-form input[name^=\"annotationid\"]").val(null);(0,b.default)(".annotation-form input[name^=\"startcontainer\"]").val(-1);(0,b.default)(".annotation-form input[name^=\"endcontainer\"]").val(-1);(0,b.default)(".annotation-form input[name^=\"startoffset\"]").val(-1);(0,b.default)(".annotation-form input[name^=\"endoffset\"]").val(-1);(0,b.default)(".annotation-form textarea[name^=\"text\"]").val("");(0,b.default)(".annotation-box").not(".annotation-form").show()}};a.init=e;function d(a){var b=[window.getSelection().getRangeAt(0)];if(b.collapsed){return null}var d=b.map(function(b){return(0,c.describe)(a,b)}),e=d.map(function(a){return{selector:a}}),f={target:e};(0,c.anchor)(f,a);return f}});
//# sourceMappingURL=annotations.min.js.map
