function _createForOfIteratorHelper(a){if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(a=_unsupportedIterableToArray(a))){var b=0,c=function(){};return{s:c,n:function n(){if(b>=a.length)return{done:!0};return{done:!1,value:a[b++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,e=!0,f=!1,g;return{s:function s(){d=a[Symbol.iterator]()},n:function n(){var a=d.next();e=a.done;return a},e:function e(a){f=!0;g=a},f:function f(){try{if(!e&&null!=d.return)d.return()}finally{if(f)throw g}}}}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}define ("mod_margic/annotations",["jquery"],function(a){return{init:function init(b,c){a(".annotation-form").hide();a(".annotation-form div.col-md-3").removeClass("col-md-3");a(".annotation-form div.col-md-9").removeClass("col-md-9");a(".annotation-form div.form-group").removeClass("form-group");a(".annotation-form div.row").removeClass("row");function d(d){if(c){s();f();var e=b[d].entry;a("input[name=\"startcontainer["+e+"]\"]").val(b[d].startcontainer);a("input[name=\"endcontainer["+e+"]\"]").val(b[d].endcontainer);a("input[name=\"startposition["+e+"]\"]").val(b[d].startposition);a("input[name=\"endposition["+e+"]\"]").val(b[d].endposition);a("input[name=\"annotationid["+e+"]\"]").val(d);a("textarea[name=\"text["+e+"]\"]").val(b[d].text);a(".annotationarea-"+e+" .annotation-form").show();a("#id_text_"+e).focus()}}function f(){a(".annotation-form").hide();a(".annotation-form input[name^=\"annotationid\"]").val(null);a(".annotation-form input[name^=\"startcontainer\"]").val(-1);a(".annotation-form input[name^=\"endcontainer\"]").val(-1);a(".annotation-form input[name^=\"startposition\"]").val(-1);a(".annotation-form input[name^=\"endposition\"]").val(-1);a(".annotation-form textarea[name^=\"text\"]").val("")}function g(a){if(a.collapsed){return[]}var b=a.commonAncestorContainer;if(b.nodeType!==Node.ELEMENT_NODE){b=b.parentElement}if(!b){return[]}var c=[],d=b.ownerDocument.createNodeIterator(b,NodeFilter.SHOW_TEXT),e;while(e=d.nextNode()){if(!i(a,e)){continue}var f=e;if(f===a.startContainer&&0<a.startOffset){f.splitText(a.startOffset);continue}if(f===a.endContainer&&a.endOffset<f.data.length){f.splitText(a.endOffset)}c.push(f)}return c}function h(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"annotated",d=g(a),e=0<d.length&&j(d[0]),f=[],h=null,i=null;d.forEach(function(a){if(h&&h.nextSibling===a){i.push(a)}else{i=[a];f.push(i)}h=a});f=f.filter(function(a){return a.some(function(a){return!/^\s*$/.test(a.nodeValue)})});var k=[];f.forEach(function(a){var d=document.createElement("span");d.className=c;if(b){d.className+=" "+c+"-"+b;d.id=c+"-"+b}a[0].parentNode.replaceChild(d,a[0]);a.forEach(function(a){return d.appendChild(a)});k.push(d)});return k}function i(a,b){try{var c,d,e=null!==(c=null===(d=b.nodeValue)||void 0===d?void 0:d.length)&&void 0!==c?c:b.childNodes.length;return 0>=a.comparePoint(b,0)&&0<=a.comparePoint(b,e)}catch(a){return!1}}function j(a){if(!a.parentElement){return!1}return null!==a.parentElement.closest(".annotator-placeholder")}function k(a){var b=a.nodeName.toLowerCase(),c=b;if("#text"===b){c="text()"}return c}function l(a){var b=0,c=a;while(c){if(c.nodeName===a.nodeName){b+=1}c=c.previousSibling}return b}function m(a){var b=k(a),c=l(a);return"".concat(b,"[").concat(c,"]")}function n(a,b){var c="",d=a;while(d!==b){if(!d){throw new Error("Node is not a descendant of root")}c=m(d)+"/"+c;d=d.parentNode}c="/"+c;c=c.replace(/\/$/,"");return c}function o(a,b,c){b=b.toUpperCase();for(var d=-1,e=0,f;e<a.children.length;e++){f=a.children[e];if(f.nodeName.toUpperCase()===b){++d;if(d===c){return f}}}return null}function p(a,b){var c=null!==a.match(/^(\/[A-Za-z0-9-]+(\[[0-9]+\])?)+$/);if(!c){throw new Error("Expression is not a simple XPath")}var d=a.split("/"),e=b;d.shift();var f=_createForOfIteratorHelper(d),g;try{for(f.s();!(g=f.n()).done;){var h=g.value,i=void 0,j=void 0,k=h.indexOf("[");if(-1!==k){i=h.slice(0,k);var l=h.slice(k+1,h.indexOf("]"));j=parseInt(l)-1;if(0>j){return null}}else{i=h;j=0}var m=o(e,i,j);if(!m){return null}e=m}}catch(a){f.e(a)}finally{f.f()}return e}function q(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:document.body;try{return p(a,b)}catch(c){return document.evaluate("."+a,b,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}function r(a,b){var c=a.parentNode;b.forEach(function(b){return c.insertBefore(b,a)});a.remove()}function s(){var b=Array.from(a("body")[0].querySelectorAll(".annotated_temp"));if(b!==void 0&&0!=b.length){t(b)}}function t(a){for(var b=0;b<a.length;b++){if(a[b].parentNode){var c=Array.from(a[b].childNodes);r(a[b],c)}}}a(document).on("mouseup",".originaltext",function(){var b=window.getSelection().getRangeAt(0);if(""!==b.cloneContents().textContent&&c){s();f();var d=this.id.replace(/entry-/,"");a("input[name=\"startcontainer["+d+"]\"]").val(n(b.startContainer,this));a("input[name=\"endcontainer["+d+"]\"]").val(n(b.endContainer,this));a("input[name=\"startposition["+d+"]\"]").val(b.startOffset);a("input[name=\"endposition["+d+"]\"]").val(b.endOffset);h(b,!1,"annotated_temp");a(".annotationarea-"+d+" .annotation-form").show();a("#id_text_"+d).focus()}});(function(){for(var c=0,d=Object.values(b);c<d.length;c++){var e=d[c],f=document.createRange();try{f.setStart(q(e.startcontainer,a("#entry-"+e.entry)[0]),e.startposition);f.setEnd(q(e.endcontainer,a("#entry-"+e.entry)[0]),e.endposition)}catch(a){}h(f,e.id)}})();a(".annotated").mouseenter(function(){var b=this.id.replace("annotated-","");a(".annotation-"+b).addClass("hovered");a(".annotated-"+b).addClass("hovered")});a(".annotated").mouseleave(function(){var b=this.id.replace("annotated-","");a(".annotation-"+b).removeClass("hovered");a(".annotated-"+b).removeClass("hovered")});a(".annotation").mouseenter(function(){var b=this.id.replace("annotation-","");a(".annotated-"+b).addClass("hovered")});a(".annotation").mouseleave(function(){var b=this.id.replace("annotation-","");a(".annotated-"+b).removeClass("hovered")});a(document).on("mouseover",".annotated_temp",function(){a(".annotated_temp").addClass("hovered")});a(document).on("mouseleave",".annotated_temp",function(){a(".annotated_temp").removeClass("hovered")});a(document).on("click",".annotated",function(){var a=this.id.replace("annotated-","");d(a)});a(document).on("click",".edit-annotation",function(){var a=this.id.replace("edit-annotation-","");d(a)});a(document).on("click","#id_cancel",function(a){a.preventDefault();s();f()})}}});
//# sourceMappingURL=annotations.min.js.map
