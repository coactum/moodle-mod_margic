{"version":3,"sources":["../src/annotations.js"],"names":["define","$","init","getSelectionHtml","window","getSelection","selection","getRangeAt","document","type","createRange","htmlText","cloneContents","textContent","getSelectionCharOffsetWithin","element","start","end","range","priorRange","cloneRange","selectNodeContents","setEnd","startContainer","startOffset","toString","length","body","createTextRange","moveToElementText","setEndPoint","text","console","log","on","mytext","rangy","getElementsByClassName","innerHTML","indexOf"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module for the annotation functions of the annotated diary.\n *\n * @module     mod_annotateddiary/annotations\n * @package    mod_annotateddiary\n * @copyright  2021 coactum GmbH\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define(['jquery'], function($) {\n    return {\n        init: function() {\n            function getSelectionHtml() {\n                if (typeof window.getSelection != \"undefined\") {\n                    var selection = window.getSelection().getRangeAt(0);\n                } else if (typeof document.selection != \"undefined\") {\n                    if (document.selection.type == \"Text\") {\n                        var selection = document.selection.createRange().htmlText;\n                    }\n                }\n                return selection.cloneContents().textContent;\n            }\n\n            function getSelectionCharOffsetWithin(element) {\n                var start = 0;\n                var end = 0;\n\n                if (typeof window.getSelection != \"undefined\") {\n                    range = window.getSelection().getRangeAt(0);\n                    priorRange = range.cloneRange();\n                    priorRange.selectNodeContents(element);\n                    priorRange.setEnd(range.startContainer, range.startOffset);\n                    start = priorRange.toString().length;\n                    end = start + range.toString().length;\n                } else if (typeof document.selection != \"undefined\") {\n                    if (document.selection.type == \"Text\") {\n                        range = document.selection.createRange();\n                        priorRange = document.body.createTextRange();\n                        priorRange.moveToElementText(element);\n                        priorRange.setEndPoint(\"EndToStart\", range);\n                        start = priorRange.text.length;\n                        end = start + range.text.length;\n                    }\n                }\n\n                console.log(priorRange);\n\n                return {\n                    start: start,\n                    end: end,\n                };\n            }\n\n            // $(document).bind(\"mouseup\", function() {\n            //     var mytext = getSelectionHtml();\n            //     console.log(mytext);\n            // });\n\n            $(document).on('mouseup', '.originaltext', function() {\n\n                console.log(this);\n\n                var mytext = getSelectionHtml();\n\n                var rangy = window.rangy;\n\n                console.log(rangy);\n\n                console.log(mytext);\n\n                console.log(document.getElementsByClassName('originaltext'));\n                console.log(document.getElementsByClassName('originaltext')[0]);\n                console.log(document.getElementsByClassName('originaltext')[0].innerHTML);\n                console.log(document.getElementsByClassName('originaltext')[0].innerHTML.indexOf(mytext));\n                //var position = document.getElementsByClassName('originaltext').indexOf(mytext);\n                //console.log(position);\n\n                console.log(getSelectionCharOffsetWithin(this));\n            });\n        }\n    };\n});"],"file":"annotations.min.js"}