define("mod_margic/xpath",["exports"],(function(_exports){function getPathSegment(node){const name=function(node){const nodeName=node.nodeName.toLowerCase();let result=nodeName;return"#text"===nodeName&&(result="text()"),result}(node),pos=function(node){let pos=0,tmp=node;for(;tmp;)tmp.nodeName===node.nodeName&&(pos+=1),tmp=tmp.previousSibling;return pos}(node);return"".concat(name,"[").concat(pos,"]")}function nthChildOfType(element,nodeName,index){nodeName=nodeName.toUpperCase();let matchIndex=-1;for(let i=0;i<element.children.length;i++){const child=element.children[i];if(child.nodeName.toUpperCase()===nodeName&&(++matchIndex,matchIndex===index))return child}return null}function evaluateSimpleXPath(xpath,root){if(!(null!==xpath.match(/^(\/[A-Za-z0-9-]+(\[[0-9]+\])?)+$/)))throw new Error("Expression is not a simple XPath");const segments=xpath.split("/");let element=root;segments.shift();for(let segment of segments){let elementName,elementIndex;const separatorPos=segment.indexOf("[");if(-1!==separatorPos){elementName=segment.slice(0,separatorPos);const indexStr=segment.slice(separatorPos+1,segment.indexOf("]"));if(elementIndex=parseInt(indexStr)-1,elementIndex<0)return null}else elementName=segment,elementIndex=0;const child=nthChildOfType(element,elementName,elementIndex);if(!child)return null;element=child}return element}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.nodeFromXPath=function(xpath){let root=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;try{return evaluateSimpleXPath(xpath,root)}catch(err){return document.evaluate("."+xpath,root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}},_exports.xpathFromNode=function(node,root){let xpath="",elem=node;for(;elem!==root;){if(!elem)throw new Error("Node is not a descendant of root");xpath=getPathSegment(elem)+"/"+xpath,elem=elem.parentNode}return xpath="/"+xpath,xpath=xpath.replace(/\/$/,""),xpath}}));

//# sourceMappingURL=xpath.min.js.map