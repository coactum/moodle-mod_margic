define("mod_margic/string-match",["exports"],(function(_exports){function reverse(s){return s.split("").reverse().join("")}function oneIfNotZero(n){return(n|-n)>>31&1}function advanceBlock(ctx,peq,b,hIn){var pV=ctx.P[b],mV=ctx.M[b],hInIsNegative=hIn>>>31,eq=peq[b]|hInIsNegative,xV=eq|mV,xH=(eq&pV)+pV^pV|eq,pH=mV|~(xH|pV),mH=pV&xH,hOut=oneIfNotZero(pH&ctx.lastRowMask[b])-oneIfNotZero(mH&ctx.lastRowMask[b]);return pH<<=1,mH<<=1,pV=(mH|=hInIsNegative)|~(xV|(pH|=oneIfNotZero(hIn)-hInIsNegative)),mV=pH&xV,ctx.P[b]=pV,ctx.M[b]=mV,hOut}function findMatchEnds(text,pattern,maxErrors){if(0===pattern.length)return[];maxErrors=Math.min(maxErrors,pattern.length);var matches=[],w=32,bMax=Math.ceil(pattern.length/w)-1,ctx={P:new Uint32Array(bMax+1),M:new Uint32Array(bMax+1),lastRowMask:new Uint32Array(bMax+1)};ctx.lastRowMask.fill(1<<31),ctx.lastRowMask[bMax]=1<<(pattern.length-1)%w;for(var emptyPeq=new Uint32Array(bMax+1),peq=new Map,asciiPeq=[],i=0;i<256;i++)asciiPeq.push(emptyPeq);for(var c=0;c<pattern.length;c+=1){var val=pattern.charCodeAt(c);if(!peq.has(val)){var charPeq=new Uint32Array(bMax+1);peq.set(val,charPeq),val<asciiPeq.length&&(asciiPeq[val]=charPeq);for(var b=0;b<=bMax;b+=1){charPeq[b]=0;for(var r=0;r<w;r+=1){var idx=b*w+r;if(!(idx>=pattern.length))pattern.charCodeAt(idx)===val&&(charPeq[b]|=1<<r)}}}}for(var y=Math.max(0,Math.ceil(maxErrors/w)-1),score=new Uint32Array(bMax+1),_b=0;_b<=y;_b+=1)score[_b]=(_b+1)*w;score[bMax]=pattern.length;for(var _b2=0;_b2<=y;_b2+=1)ctx.P[_b2]=-1,ctx.M[_b2]=0;for(var j=0;j<text.length;j+=1){var charCode=text.charCodeAt(j),_charPeq=void 0;charCode<asciiPeq.length?_charPeq=asciiPeq[charCode]:void 0===(_charPeq=peq.get(charCode))&&(_charPeq=emptyPeq);for(var carry=0,_b3=0;_b3<=y;_b3+=1)carry=advanceBlock(ctx,_charPeq,_b3,carry),score[_b3]+=carry;if(score[y]-carry<=maxErrors&&y<bMax&&(1&_charPeq[y+1]||carry<0)){y+=1,ctx.P[y]=-1,ctx.M[y]=0;var maxBlockScore=void 0;if(y===bMax){var remainder=pattern.length%w;maxBlockScore=0===remainder?w:remainder}else maxBlockScore=w;score[y]=score[y-1]+maxBlockScore-carry+advanceBlock(ctx,_charPeq,y,carry)}else for(;y>0&&score[y]>=maxErrors+w;)y-=1;y===bMax&&score[y]<=maxErrors&&(score[y]<maxErrors&&matches.splice(0,matches.length),matches.push({start:-1,end:j+1,errors:score[y]}),maxErrors=score[y])}return matches}return Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function(text,pattern,maxErrors){var matches=findMatchEnds(text,pattern,maxErrors);return function(text,pattern,matches){var patRev=reverse(pattern);return matches.map((function(m){var minStart=Math.max(0,m.end-pattern.length-m.errors);return{start:findMatchEnds(reverse(text.slice(minStart,m.end)),patRev,m.errors).reduce((function(min,rm){return m.end-rm.end<min?m.end-rm.end:min}),m.end),end:m.end,errors:m.errors}}))}(text,pattern,matches)},_exports.default}));

//# sourceMappingURL=string-match.min.js.map