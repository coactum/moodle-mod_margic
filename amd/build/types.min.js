define("mod_margic/types",["exports","./match-quote","./text-range","./xpath"],(function(_exports,_matchQuote,_textRange,_xpath){function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.TextQuoteAnchor=_exports.TextPositionAnchor=_exports.RangeAnchor=void 0;var RangeAnchor=function(){function RangeAnchor(root,range){_classCallCheck(this,RangeAnchor),this.root=root,this.range=range}return _createClass(RangeAnchor,[{key:"toRange",value:function(){return this.range}},{key:"toSelector",value:function(){var normalizedRange=_textRange.TextRange.fromRange(this.range).toRange(),textRange=_textRange.TextRange.fromRange(normalizedRange),startContainer=(0,_xpath.xpathFromNode)(textRange.start.element,this.root),endContainer=(0,_xpath.xpathFromNode)(textRange.end.element,this.root);return{type:"RangeSelector",startContainer:startContainer,startOffset:textRange.start.offset,endContainer:endContainer,endOffset:textRange.end.offset}}}],[{key:"fromRange",value:function(root,range){return new RangeAnchor(root,range)}},{key:"fromSelector",value:function(root,selector){var startContainer=(0,_xpath.nodeFromXPath)(selector.startContainer,root);if(!startContainer)throw new Error("Failed to resolve startContainer XPath");var endContainer=(0,_xpath.nodeFromXPath)(selector.endContainer,root);if(!endContainer)throw new Error("Failed to resolve endContainer XPath");var startPos=_textRange.TextPosition.fromCharOffset(startContainer,selector.startOffset),endPos=_textRange.TextPosition.fromCharOffset(endContainer,selector.endOffset);return new RangeAnchor(root,new _textRange.TextRange(startPos,endPos).toRange())}}]),RangeAnchor}();_exports.RangeAnchor=RangeAnchor;var TextPositionAnchor=function(){function TextPositionAnchor(root,start,end){_classCallCheck(this,TextPositionAnchor),this.root=root,this.start=start,this.end=end}return _createClass(TextPositionAnchor,[{key:"toSelector",value:function(){return{type:"TextPositionSelector",start:this.start,end:this.end}}},{key:"toRange",value:function(){return _textRange.TextRange.fromOffsets(this.root,this.start,this.end).toRange()}}],[{key:"fromRange",value:function(root,range){console.log("TextPositionAnchor -> fromRange root"),console.log(root);var textRange=_textRange.TextRange.fromRange(range).relativeTo(root);return new TextPositionAnchor(root,textRange.start.offset,textRange.end.offset)}},{key:"fromSelector",value:function(root,selector){return new TextPositionAnchor(root,selector.start,selector.end)}}]),TextPositionAnchor}();_exports.TextPositionAnchor=TextPositionAnchor;var TextQuoteAnchor=function(){function TextQuoteAnchor(root,exact){var context=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,TextQuoteAnchor),this.root=root,this.exact=exact,this.context=context}return _createClass(TextQuoteAnchor,[{key:"toSelector",value:function(){return{type:"TextQuoteSelector",exact:this.exact,prefix:this.context.prefix,suffix:this.context.suffix}}},{key:"toRange",value:function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.toPositionAnchor(options).toRange()}},{key:"toPositionAnchor",value:function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},text=this.root.textContent,match=(0,_matchQuote.matchQuote)(text,this.exact,_objectSpread(_objectSpread({},this.context),{},{hint:options.hint}));if(!match)throw new Error("Quote not found");return new TextPositionAnchor(this.root,match.start,match.end)}}],[{key:"fromRange",value:function(root,range){var text=root.textContent,textRange=_textRange.TextRange.fromRange(range).relativeTo(root),start=textRange.start.offset,end=textRange.end.offset;return new TextQuoteAnchor(root,text.slice(start,end),{prefix:text.slice(Math.max(0,start-32),start),suffix:text.slice(end,Math.min(text.length,end+32))})}},{key:"fromSelector",value:function(root,selector){var prefix=selector.prefix,suffix=selector.suffix;return new TextQuoteAnchor(root,selector.exact,{prefix:prefix,suffix:suffix})}}]),TextQuoteAnchor}();_exports.TextQuoteAnchor=TextQuoteAnchor}));

//# sourceMappingURL=types.min.js.map