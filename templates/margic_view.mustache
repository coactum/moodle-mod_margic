{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @copyright   2021 coactum GmbH
    @template discourse/discourse_view

    Overview.
}}

{{#js}}
{{/js}}

{{#edittimeends}}{{^caneditentries}}<div class="alert alert-danger alert-block fade in" role="alert"><button type="button" class="close" data-dismiss="alert">Ã—</button>{{#str}}editingended, mod_margic{{/str}}</div>{{/caneditentries}}{{/edittimeends}}

{{#canmanageentries}}<h3>{{#str}}entries, mod_margic{{/str}}</h3>{{/canmanageentries}}
{{^canmanageentries}}<h3>{{#str}}myentries, mod_margic{{/str}}</h3>{{/canmanageentries}}

<div class="pb-2">
    {{#ratingaggregationmode}}{{#entries.0}}
            <strong>{{ratingaggregationmode}}: </strong>

            {{#currentuserrating}}
                {{currentuserrating}}
            {{/currentuserrating}}
    {{/entries.0}}{{/ratingaggregationmode}}
    <span class="pull-right pr-5">
        <strong>{{#str}}sorting, mod_margic{{/str}}</strong>{{#sortmode}}<strong>: </strong>{{sortmode}}{{/sortmode}}
    </span>
</div>

<div class="pb-1">
    <a class="btn btn-primary mr-1" href="edit.php?id={{cmid}}"> {{#str}}startnewentry, mod_margic{{/str}} </a>
    {{#canmanageentries}}<button class="btn btn-primary" data-toggle="collapse" data-target=".gradingform" aria-expanded="false" aria-controls=".gradingform" title="{{#str}}toggleratingform, mod_margic{{/str}}">{{#str}}toggleratingform, mod_margic{{/str}}</button>{{/canmanageentries}}
    {{#canmanageentries}}{{#singleuser}}<a class="btn btn-primary m-1" href="view_reworked.php?id={{cmid}}"> {{#str}}seeallentries, mod_margic{{/str}} </a>{{/singleuser}}{{/canmanageentries}}

    <span class="pull-right p-1">
        <a href="view_reworked.php?id={{cmid}}&action=download" class="p-1 pr-2 border-right solid"><i class="fa fa-2x fa-download" title="{{#str}}csvexport, mod_margic{{/str}}"></i></a>
        <a href="view_reworked.php?id={{cmid}}&action=currenttooldest" class="p-1"><i class="fa fa-2x fa-arrow-down" title="{{#str}}currenttooldest, mod_margic{{/str}}"></i></a>
        <a href="view_reworked.php?id={{cmid}}&action=oldesttocurrent" class="p-1"><i class="fa fa-2x fa-arrow-up" title="{{#str}}oldesttocurrent, mod_margic{{/str}}"></i></a>
        <a href="view_reworked.php?id={{cmid}}&action=lowestgradetohighest" class="p-1"><i class="fa fa-2x fa-thumbs-down" title="{{#str}}lowestgradetohighest, mod_margic{{/str}}"></i></a>
        <a href="view_reworked.php?id={{cmid}}&action=highestgradetolowest" class="p-1"><i class="fa fa-2x fa-thumbs-up" title="{{#str}}highestgradetolowest, mod_margic{{/str}}"></i></a>
        <a href="view_reworked.php?id={{cmid}}&action=latestmodified" class="p-1"><i class="fa fa-2x fa-pencil" title="{{#str}}latestmodified, mod_margic{{/str}}"></i></a>
    </span>
</div>

{{#entries.0}}
<form action="view_reworked.php?id={{cmid}}" method="post">
    <input type="hidden" name="id" value="{{cmid}}">
    <input type="hidden" name="sesskey" value="{{sesskey}}">

    <div class="mt-1">
        <ul class="pagination">
            {{#pagebar}}
                <li class="page-item">
                    <a class="page-link" href="view_reworked.php?id={{cmid}}&page={{nr}}">{{{display}}}</a>
                </li>
            {{/pagebar}}

            <div class="ml-auto">
                {{#str}}pagesize, mod_margic{{/str}}:
                <select onchange="this.form.submit()" aria-label="Select page count" name="pagecount">
                    {{#pagecountoptions}}<option {{option}}>{{text}}</option>{{/pagecountoptions}}
                </select>
            </div>
        </ul>
    </div>
</form>

{{/entries.0}}

{{#canmanageentries}}{{#entries.0}}
    <form action="view_reworked.php" method="post">
        <input type="hidden" name="id" value="{{cmid}}">
        <input type="hidden" name="sesskey" value="{{sesskey}}">
{{/entries.0}}{{/canmanageentries}}

{{#entries}}
    <div class="entry" style="background: {{entrybgc}};">
        <h4>{{#str}}entry, mod_margic{{/str}}: {{#userdate}}{{timecreated}}, {{#str}} strftimedaydatetime, core_langconfig {{/str}}{{/userdate}}
            {{#entrycanbeedited}}{{#caneditentries}}<a href="edit.php?id={{cmid}}&entryid={{id}}"><i class="fa fa-pencil" title="{{#str}}editthisentry, mod_margic{{/str}}"></i></a>{{/caneditentries}}{{/entrycanbeedited}}
        </h4>

        {{#user}}
            {{#canmanageentries}}
                {{{userpicture}}} {{firstname}} {{lastname}} {{^singleuser}}<a href="view_reworked.php?id={{cmid}}&userid={{userid}}"><i class="fa fa-user fa-lg" title="{{#str}}getallentriesofuser, mod_margic{{/str}}"></i></a>{{/singleuser}}
            {{/canmanageentries}}
        {{/user}}

        <div class="entry" style="background: {{entrytextbgc}};">
            {{#text}}{{{text}}}{{/text}}
            {{^text}}<p class="text-center"><strong>{{#str}}blankentry, mod_margic{{/str}}</strong></p>{{/text}}
        </div>
        <div class="lastedit">
            {{#stats}}
                <strong>{{#str}}details, mod_margic{{/str}}:</strong> {{#str}}numwordsraw, mod_margic, { "wordscount": {{words}}, "charscount": {{chars}}, "spacescount": {{spaces}} } {{/str}}<br>
                {{#datediff}}
                    {{#str}}created, mod_margic, { "days": {{datediff.d}}, "hours": {{datediff.h}} } {{/str}}<br>
                {{/datediff}}
            {{/stats}}
            <strong>{{#str}}timecreated, mod_margic{{/str}}: </strong> {{#userdate}}{{timecreated}}, {{#str}} strftimedaydatetime, core_langconfig {{/str}}{{/userdate}}{{#timemodified}} | <strong> {{#str}} lastedited, mod_margic {{/str}}: </strong> {{#userdate}}{{timemodified}}, {{#str}} strftimedaydatetime, core_langconfig {{/str}}{{/userdate}}{{/timemodified}}<br>
        </div>

        {{#needsgrading}}
            <div class="needsedit">{{needsgrading}}</div>
        {{/needsgrading}}

        {{#needsregrading}}
            <div class="needsedit">{{needsregrading}}</div>
        {{/needsregrading}}

        {{#edittimeends}}
            <div class="editend">
                {{#caneditentries}}{{#str}}editingends, mod_margic{{/str}}: {{/caneditentries}}
                {{^caneditentries}}{{#str}}editingended, mod_margic{{/str}}: {{/caneditentries}}
                {{#userdate}}{{edittimeends}}, {{#str}} strftimedaydatetime, core_langconfig {{/str}}{{/userdate}}
            </div>
        {{/edittimeends}}

        {{#canmanageentries}}
            {{#gradingform}}
                <div class="gradingform collapse {{#gradingmode}}show{{/gradingmode}}">
                    {{{gradingform}}}
                </div>
            {{/gradingform}}
        {{/canmanageentries}}
        {{^canmanageentries}}
            {{#gradingform}}{{{gradingform}}}{{/gradingform}}
        {{/canmanageentries}}

    </div>
{{/entries}}
{{#canmanageentries}}{{#entries.0}}</form>{{/entries.0}}{{/canmanageentries}}

{{^entries}}
    <br>
    {{#canmanageentries}}{{#str}}noentriesfound, mod_margic{{/str}}{{/canmanageentries}}
    {{^canmanageentries}}{{#str}}notstarted, mod_margic{{/str}}{{/canmanageentries}}
{{/entries}}